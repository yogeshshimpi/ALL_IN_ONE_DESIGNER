import{r as i,u as I,j as s,L as N}from"./index-D0jTGpOe.js";import{u as R,v as K,a as M}from"./index.esm-dKqOkKeh.js";import{R as D}from"./ReverseTimer-NxXJsJkJ.js";const J=()=>{const[h,b]=i.useState(!0),y=I(),[c,S]=i.useState(new Array(6).fill("")),k=c.length,O=()=>{b(!h)},{register:j,handleSubmit:P,trigger:m,getValues:x,setError:d,clearErrors:r,formState:{errors:u,isSubmitting:v}}=R(),[g,f]=i.useState(!1),[w,T]=i.useState(null),l=i.useRef([]),[E,F]=i.useState(0),L=async t=>{const{name:e,password:a}=t,n=w;console.log({name:e,password:a,otp:n});const o=await(await fetch("http://localhost:3000/api/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,password:a,otp:n}),credentials:"include"})).json();o.message==="success"?y("/home"):o.message==="invalidOtp"?d("otp",{type:"manual",message:"Otp is invalid"}):r("otp")},p=async t=>{if(t==="next"){const e=await m("name"),a=await m("password");if(e&&a){const n={name:x("name"),password:x("password")},o=await(await fetch("http://localhost:3000/api/sendSignInOtp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"include"})).json();o.message==="success"?f(!0):o.message==="usernameInvalid"?(d("name",{message:"Username is not match"}),r("password")):o.message==="passwordInvalid"?(d("password",{message:"Pasword is not match"}),r("name")):(r("name"),r("password"))}}t==="name"&&await m("name"),t==="password"&&await m("password"),t==="back"&&f(!1)},C=(t,e)=>{const a=t.target.value,n=[...c];n[e]=a.substring(a.length-1),S(n),T(n.join("")),a&&e<k-1&&l.current[e+1]&&l.current[e+1].focus(),isNaN(w)?d("otp",{type:"manual",message:"Please enter the valid otp "}):r("otp")},q=(t,e)=>{t.key==="Backspace"&&!c[e]&&e>0&&l.current[e-1]&&l.current[e-1].focus()};return s.jsxs("section",{className:"hero",children:[s.jsx("div",{className:"heading",children:"Sign In"}),s.jsx("div",{className:"sub-heading",children:"Enter your credential to login"}),s.jsxs("form",{action:"",className:"form",onSubmit:P(L),children:[g?s.jsxs("div",{className:"otp-validation",children:[s.jsx("div",{className:"text",children:"Enter 6-digit code sent to your email. This code is valid for the next 5 minutes"}),s.jsxs("div",{className:"otpfield",children:[s.jsx("div",{className:"otp-input",children:c.map((t,e)=>s.jsx("input",{type:"text",value:t,onChange:a=>{C(a,e)},ref:a=>l.current[e]=a,onKeyDown:a=>{q(a,e)},placeholder:"0"},e))}),s.jsxs("div",{className:"resend-timer",children:[s.jsx("span",{children:"Otp valid for 5 minute"}),g?s.jsx(i.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:s.jsx(D,{initialTime:E})}):s.jsx("span",{})]})]}),s.jsx("div",{})]}):s.jsxs("div",{className:"input-sec",children:[s.jsxs("div",{className:"username",children:[s.jsx("input",{type:"text",onKeyUp:()=>{p("name")},placeholder:"username",...j("name",{required:{value:!0,message:"Username is required"},minLength:{value:3,message:"Minimum length is 3 "},maxLength:{value:15,message:"Maximum length is 15 "},pattern:{value:/^\S*$/,message:"Username should not contain any spaces"}})}),s.jsx("div",{className:"error",children:u.name&&u.name.message})]}),s.jsxs("div",{className:"password",children:[s.jsxs("div",{className:"password-field",children:[s.jsx("input",{type:h?"password":"text",onKeyUp:()=>{p("password")},placeholder:"Password",...j("password",{required:{value:!0,message:"Password is required"},minLength:{value:3,message:"Minimum length 3 required"},maxLength:{value:15,message:"Maximum length 15 required"},pattern:{value:/^(?=.*[!@#$%^&*(),.?":{}|<>])(?=.*\d).+$/,message:"Password should contain special character and numeric value"}})}),s.jsx("button",{className:"pass",type:"button",onClick:()=>{O()},children:s.jsx("img",{src:h?K:M,className:"image",alt:""})})]}),s.jsx("div",{className:"error",children:u.password&&u.password.message})]})]}),g?s.jsxs("div",{className:"button",children:[s.jsx("button",{className:"submit",type:"button",onClick:()=>{p("back")},children:"Back"}),s.jsx("button",{disabled:v,className:"submit",type:"submit",children:v?s.jsx("div",{className:"loader"}):"submit"})]}):s.jsx("button",{className:"submit",onClick:()=>{p("next")},type:"button",children:"Next"})]}),s.jsx("div",{className:"forget",children:s.jsx(N,{to:"/forgetpassword",className:"Link",children:"Forget password"})}),s.jsx("span",{className:"or"}),s.jsx("div",{className:"sign_in",children:s.jsxs("div",{children:["Don' t hava an account?"," ",s.jsx("button",{children:s.jsx(N,{to:"/sign-up",children:"Sign Up"})})]})})]})};export{J as default};
