import{r as i,j as e,L as M}from"./index-D0jTGpOe.js";import{u as R,v as y,a as b}from"./index.esm-dKqOkKeh.js";const $="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m313-440%20224%20224-57%2056-320-320%20320-320%2057%2056-224%20224h487v80H313Z'/%3e%3c/svg%3e",U=()=>{const[u,N]=i.useState(!1),[p,P]=i.useState(!1),h=i.useRef(),[c,S]=i.useState(new Array(6).fill("")),O=c.length,[m,C]=i.useState(null),[g,f]=i.useState(!1),{register:d,handleSubmit:E,setError:o,watch:T,clearErrors:v,trigger:k,getValues:q,formState:{errors:r,isSubmitting:V}}=R(),F=T("password"),l=i.useRef([]),w=a=>{a==0?N(!u):P(!p)};i.useEffect(()=>{h.current&&h.current.focus()},[]);const L=(a,s)=>{const t=a.target.value,n=[...c];n[s]=t.substring(t.length-1),S(n),C(n.join("")),t&&s<O-1&&l.current[s+1]&&l.current[s+1].focus(),isNaN(m)?o("otp",{type:"manual",message:"Please enter the valid otp "}):v("otp")},B=(a,s)=>{a.key==="Backspace"&&!c[s]&&s>0&&l.current[s-1]&&l.current[s-1].focus()},x=async a=>{if(a.button){const s=a.name,n=await(await fetch("http://localhost:3000/api/sendOtp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s}),credentials:"include"})).json();n.message?o("name",{type:"manual",message:"The username is doesn't exist"}):(v("name.manual"),alert("otp was send to your email"),f(!0),setTimeout(()=>{f(!1)},3e5)),n.server&&alert("Problem is in server please try again later")}else{const{name:s,password:t}=a,n=m;if(!m||m.length!==6){o("otp",{type:"manual",message:"OTP must be exactly 6 digits long."});return}const j=await(await fetch("http://localhost:3000/api/verifiedOtp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,password:t,otp:n}),credentials:"include"})).json();j.message==="otpInvalid"?o("otp",{type:"manual",message:"Please Enter the valid otp"}):j.message==="nameInvalid"&&o("name",{type:"manual",message:"Please Enter valid username"})}},I=async()=>{if(await k("name")){const s={name:q("name"),button:!0};x(s)}};return e.jsxs("section",{className:"hero",children:[e.jsx("div",{className:"heading",children:"Forget Password"}),e.jsx("div",{className:"sub-heading",children:"Change your password"}),e.jsxs("form",{action:"",onSubmit:E(x),children:[e.jsxs("div",{className:"username",children:[e.jsx("input",{type:"text",placeholder:"username",...d("name",{required:{value:!0,message:"Username is required"},minLength:{value:3,message:"Minimum length 3 required"},maxLength:{value:15,message:"Maximum length 15 required"},pattern:{value:/^(?=.*[!@#$%^&*(),.?":{}|<>])(?=.*\d).+$/,message:"Username should contain special character and numeric value"}}),ref:a=>{d("name").ref(a),h.current=a}}),e.jsx("div",{className:"error",children:r.name&&r.name.message})]}),e.jsx("button",{type:"button",style:{backgroundColor:g?"rgba(255, 255, 255, 0.799)":"white"},disabled:g,onClick:I,name:"sendOtp",className:"otp-send",children:"Send OTP"}),e.jsxs("div",{className:"otp",children:["Enter OTP ",e.jsx("div",{className:"timer"}),e.jsx("div",{className:"otp-input",children:c.map((a,s)=>e.jsx("input",{type:"text",value:a,onChange:t=>{L(t,s)},ref:t=>l.current[s]=t,onKeyDown:t=>{B(t,s)},placeholder:"0"},s))}),e.jsx("div",{className:"error",children:r.otp&&r.otp.message})]}),e.jsxs("div",{className:"password",children:[e.jsxs("div",{className:"password-field",children:[e.jsx("input",{type:u?"password":"text",placeholder:"Password",...d("password",{required:{value:!0,message:"Password is required"},minLength:{value:3,message:"Minimum length 3 required"},maxLength:{value:15,message:"Maximum length 15 required"},pattern:{value:/^(?=.*[!@#$%^&*(),.?":{}|<>])(?=.*\d).+$/,message:"Password should contain special character and numeric value"}})}),e.jsx("button",{className:"pass",type:"button",onClick:()=>{w(0)},children:e.jsx("img",{src:u?y:b,className:"image",alt:""})})]}),e.jsx("div",{className:"error",children:r.password&&r.password.message})]}),e.jsxs("div",{className:"confirm-password",children:[e.jsxs("div",{className:"password-field",children:[e.jsx("input",{type:p?"password":"text",placeholder:"Confirm password",...d("confirmPassword",{required:{value:!0,message:"This field is required"},validate:a=>a===F||"Passwords do not match"})}),e.jsx("button",{className:"pass",type:"button",onClick:()=>{w(1)},children:e.jsx("img",{src:p?y:b,className:"image",alt:""})})]}),e.jsx("div",{className:"error",children:r.confirmPassword&&r.confirmPassword.message})]}),e.jsx("button",{type:"submit",name:"verifiedOtp",className:"submit",children:"Submit"})]}),e.jsxs("div",{className:"go-back",children:[e.jsx("button",{children:e.jsx(M,{to:"/sign-in",children:e.jsx("img",{src:$,alt:""})})})," Back to Sign In"]})]})};export{U as default};
